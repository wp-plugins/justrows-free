!function(e){e.fn.justrows=function(a,t){var i={operation:"init",elements:!1,animation:"fade","animation-duration":1e3,"caption-attr":"title","caption-height-zero":!1,"max-row-height":200,margin:10,paddings:[0,0,0,0],"border-widths":[0,0,0,0],"primary-image-class":"jr-img","refresh-on-resize":!0,"resize-refresh-delay":200,"pre-resize-callback":!1,"post-resize-callback":!1};return this.each(function(){function n(e){return $image=e.find("img"),$image.length>1&&$image.filter("."+i["primary-image-class"]),imageDimensions={width:$image.attr("width"),height:$image.attr("height")},imageDimensions.height<i["max-row-height"]&&(imageDimensions.width=imageDimensions.width*(i["max-row-height"]/imageDimensions.height),imageDimensions.height=i["max-row-height"]),void 0==e.data("ratio")&&e.data("ratio",imageDimensions.width/imageDimensions.height),imageDimensions}function r(a,t){a.each(function(){$element=e(this),w=t*$element.data("ratio"),$element.css({height:t,width:w,"padding-top":i.paddings[0],"padding-right":i.paddings[1],"padding-bottom":i.paddings[2],"padding-left":i.paddings[3],"border-top-width":i["border-widths"][0],"border-right-width":i["border-widths"][1],"border-bottom-width":i["border-widths"][2],"border-left-width":i["border-widths"][3],"margin-right":i.margin}),$image=$element.find("img"),$image.length>1&&$image.filter("."+i["primary-image-class"]),0!=i["caption-attr"]&&(caption=$image.attr(i["caption-attr"]),"undefined"!=typeof caption&&caption!==!1&&""!=caption&&($caption=e('<div class="'+i["caption-class"]+'">'+caption+"</div>"),$element.append($caption)))})}function s(a,t,s,o){return rowImagesDimensions=0==o?new Array:o,$addedElements=e(),lastIndex=t,rowIsIncomplete=!0,lastIteration=a.length-1,rowHeight=i["max-row-height"],a.each(function(a){return $el=e(this),lastIndex++,$el.attr("data-"+i["data-index-key"],lastIndex),$addedElements=$addedElements.add($el),elDimensions=n($el),rowImagesDimensions.push(elDimensions),denominator=0,e.each(rowImagesDimensions,function(){denominator+=this.width/this.height}),totalMargins=rowImagesDimensions.length*i.margin,totalPaddings=rowImagesDimensions.length*(i.paddings[1]+i.paddings[3]),totalBorders=rowImagesDimensions.length*(i["border-widths"][1]+i["border-widths"][3]),calculatedHeight=(s-totalMargins-totalPaddings-totalBorders)/denominator,calculatedHeight<=i["max-row-height"]?(rowIsIncomplete=!1,rowHeight=calculatedHeight,r($addedElements,rowHeight),$addedElements.last().css("margin-right",""),!1):a==lastIteration?(r($addedElements,rowHeight),!1):void 0}),{height:rowHeight,addedElements:$addedElements,lastIndex:lastIndex,isIncomplete:rowIsIncomplete}}function o(a,t,n){for($rows=e(),lastIndex=f.attr("data-"+i["data-last-index-key"]),toAddNum=a.length;a.length>0;)rowArray=s(a,lastIndex,t,!1),a=a.not(rowArray.addedElements),wrapString='<div class="'+i["row-wrapper-class"],rowArray.isIncomplete&&(wrapString+=" "+i["incomplete-row-class"]),wrapString+='" style="padding-bottom:'+i.margin+"px; width:"+t+'px;" />',$row=rowArray.addedElements.wrapAll(wrapString).parent(),$rows=$rows.add($row),lastIndex=rowArray.lastIndex;n&&f.append($rows),f.attr("data-"+i["data-last-index-key"],lastIndex),d($rows)}function d(a){a.each(function(){var a=this;jQuery().imagesLoaded(a,function(){e(a).children("."+i["element-class"]).each(function(){switch($element=e(this),i["caption-height-zero"]&&($caption=$element.children("."+i["caption-class"]),$caption.css({"padding-top":0,"padding-bottom":0,"border-top":0,"border-bottom":0}),$caption.attr("data-"+i["data-caption-height"],$caption.height()),$caption.css({overflow:"hidden",height:0})),i.animation){case"fade":0==$element.css("opacity")&&$element.stop().fadeTo(i["animation-duration"],1)}})})})}function l(){i.animation=f.data("animation"),i["animation-duration"]=f.data("animation-duration"),i["caption-attr"]=f.data("caption-attr"),i["caption-height-zero"]=f.data("caption-height-zero"),i["max-row-height"]=f.data("max-row-height"),i.margin=f.data("margin"),i.paddings=f.data("paddings"),i["border-widths"]=f.data("border-widths"),i["primary-image-class"]=f.data("primary-image-class"),i["refresh-on-resize"]=f.data("refresh-on-resize"),i["resize-refresh-delay"]=f.data("resize-refresh-delay"),i["pre-resize-callback"]=f.data("pre-resize-callback"),i["post-resize-callback"]=f.data("post-resize-callback")}function m(a){if(f.addClass(i["container-class"]).attr("data-"+i["data-last-index-key"],0),$elements=f.children(),!a){switch($elements.addClass(i["element-class"]),f.css("padding-left",i.margin),f.css("padding-top",i.margin),i.animation){case"fade":if(!jQuery().imagesLoaded){i.animation=!1,f.data("animation",!1);break}f.data("animation","fade"),f.addClass(i["fade-class"]);break;default:i.animation=!1,f.data("animation",!1)}if(f.data("animation-duration",i["animation-duration"]),f.data("caption-attr",i["caption-attr"]),f.data("caption-height-zero",i["caption-height-zero"]),f.data("max-row-height",i["max-row-height"]),f.data("margin",i.margin),f.data("paddings",i.paddings),f.data("border-widths",i["border-widths"]),f.data("primary-image-class",i["primary-image-class"]),f.data("refresh-on-resize",i["refresh-on-resize"]),f.data("resize-refresh-delay",i["resize-refresh-delay"]),f.data("pre-resize-callback",i["pre-resize-callback"]),f.data("post-resize-callback",i["post-resize-callback"]),u=f.width(),i["refresh-on-resize"]){var t=null;e(window).on("resize.justrows",function(){f.width()!=u&&(f.css("opacity",0),t&&clearTimeout(t),t=setTimeout(function(){c(!0)},i["resize-refresh-delay"]),u=f.width())})}}p.css("overflow","scroll"),rowWidth=f.width(),p.css("overflow",""),o($elements,rowWidth,!1),a&&f.css("opacity",1)}function c(e){e&&"function"==typeof i["pre-resize-callback"]&&i["pre-resize-callback"].call(),g(!0),l(),m(!0),e&&"function"==typeof i["post-resize-callback"]&&i["post-resize-callback"].call()}function h(){f.children().children("."+i["element-class"]).removeClass(i["new-element-class"]),0!=i.elements&&($elementsToAdd=i.elements,$elementsToAdd.addClass(i["element-class"]),$elementsToAdd.addClass(i["new-element-class"]),l(),p.css("overflow","scroll"),rowWidth=f.width(),p.css("overflow",""),$incompleteRow=f.children("."+i["incomplete-row-class"]),$incompleteRow.length>0&&(rowImagesDimensions=new Array,$startingElements=$incompleteRow.children("."+i["element-class"]),$startingElements.each(function(){$element=e(this),rowImagesDimensions.push(n($element))}),rowArray=s($elementsToAdd,f.attr("data-"+i["data-last-index-key"]),rowWidth,rowImagesDimensions),$elementsToAdd=$elementsToAdd.not(rowArray.addedElements),r($startingElements,rowArray.height),rowArray.isIncomplete||($incompleteRow.removeClass(i["incomplete-row-class"]),rowArray.addedElements.last().css("margin-right","")),$startingElements.last().after(rowArray.addedElements),f.attr("data-"+i["data-last-index-key"],rowArray.lastIndex),d($incompleteRow)),$elementsToAdd.length>0&&o($elementsToAdd,rowWidth,!0))}function g(a){$elements=f.children().children(),$elements.children("."+i["caption-class"]).remove(),$elements.unwrap(),$elements.removeAttr("style"),a||(i["refresh-on-resize"]&&(clearTimeout($),e(window).off("resize.justrows")),f.removeAttr("style"),f.removeData("animation"),f.removeData("animation-duration"),f.removeData("caption-attr"),f.removeData("caption-height-zero"),f.removeData("max-row-height"),f.removeData("margin"),f.removeData("paddings"),f.removeData("border-widths"),f.removeData("primary-image-class"),f.removeData("refresh-on-resize"),f.removeData("resize-refresh-delay"),f.removeData("pre-resize-callback"),f.removeData("post-resize-callback"),f.removeAttr("data-"+i["data-last-index-key"]),$elements.removeAttr("data-"+i["data-index-key"]),$elements.removeData("ratio"),f.removeClass(i["fade-class"]),f.removeClass(i["container-class"]))}a&&e.extend(i,a),fixedSettings={"container-class":"jr-container","element-class":"jr-element","new-element-class":"jr-new-element","row-wrapper-class":"jr-row","incomplete-row-class":"jr-incomplete-row","data-index-key":"jr-index","data-last-index-key":"jr-last-index","fade-class":"jr-fade","caption-class":"jr-caption","data-caption-height":"jr-caption-height"},e.extend(i,fixedSettings);var p=e("html"),f=e(this),$=null,u=null;switch(i.operation){case"init":m(!1);break;case"refresh":c(!1);break;case"append":h();break;case"remove":g(!1)}"function"==typeof t&&t.call()})}}(jQuery);